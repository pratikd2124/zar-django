{% extends 'dashboard/template.html' %}
{% block content %}

            <!-- index body start -->
            <div class="page-body">
                <div class="container-fluid">
                    <div class="row">
                        <!-- chart caard section start -->
                        <div class="col-sm-6 col-xxl-3 col-lg-6">
                            <div class="main-tiles border-5 border-0  card-hover card o-hidden">
                                <div class="custome-1-bg b-r-4 card-body">
                                    <div class="media align-items-center static-top-widget">
                                        <div class="media-body p-0">
                                            <span class="m-0">Users</span>
                                            <h4 class="mb-0 counter"> {{Home_Owner_count}}
                                             
                                            </h4>
                                        </div>
                                        <div class="align-self-center text-center">
                                            <i class="ri-database-2-line"></i>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="col-sm-6 col-xxl-3 col-lg-6">
                            <div class="main-tiles border-5 card-hover border-0 card o-hidden">
                                <div class="custome-2-bg b-r-4 card-body">
                                    <div class="media static-top-widget">
                                        <div class="media-body p-0">
                                            <span class="m-0"> No. Categories </span>
                                            <h4 class="mb-0 counter">{{categories.count}}
                                               
                                            </h4>
                                        </div>
                                        <div class="align-self-center text-center">
                                            <i class="ri-shopping-bag-3-line"></i>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="col-sm-6 col-xxl-3 col-lg-6">
                            <div class="main-tiles border-5 card-hover border-0 card o-hidden">
                                <div class="custome-4-bg b-r-4 card-body">
                                    <div class="media static-top-widget">
                                        <div class="media-body p-0">
                                            <span class="m-0">Sevice providers</span>
                                            <h4 class="mb-0 counter">{{Service_Provider_count}}
                                             
                                            </h4>
                                        </div>

                                        <div class="align-self-center text-center">
                                            <i class="ri-shopping-bag-3-line"></i>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="col-sm-6 col-xxl-3 col-lg-6">
                            <div class="main-tiles border-5 card-hover border-0  card o-hidden">
                                <div class="custome-3-bg b-r-4 card-body">
                                    <div class="media static-top-widget">
                                        <div class="media-body p-0">
                                            <span class="m-0">Total Brands</span>
                                            <h4 class="mb-0 counter">{{material_provider_count}}
                                               
                                            </h4>
                                        </div>

                                        <div class="align-self-center text-center">
                                            <i class="ri-chat-3-line"></i>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        

                     <!-- Recent orders start-->
                     <div class="col-xl-12">
                        <div class="card o-hidden card-hover">
                            <div class="card-header card-header-top card-header--2 px-0 pt-0">
                                <div class="card-header-title">
                                    <h4>Category Visits Chart</h4>
                                </div>

                               
                            </div>

                            <div class="card-body p-0">
                                <div id="report">
                                    <canvas id="categoryVisitsChart" style="width:100%;max-width:"></canvas>

                                </div>
                            </div>
                        </div>
                    </div>
                    <!-- Recent orders end-->


                        <!-- Earning chart star-->
                        <div class="col-xl-6">
                            <div class="card o-hidden card-hover">
                                <div class="card-header border-0 pb-1">
                                    <div class="card-header-title">
                                        <h4>Weekly Active Users</h4>
                                    </div>
                                </div>
                                <div class="card-body p-0">
                                    <div id="report">
                                        <canvas id="weeklyActiveUsersChart" style="width:100%;max-width:"></canvas>

                                    </div>
                                </div>
                            </div>
                        </div>
                        <!-- Earning chart  end-->


                        <!-- Best Selling Product Start -->
                        <div class="col-xl-6 col-md-12">
                            <div class="card o-hidden card-hover">
                                <div class="card-header card-header-top card-header--2 px-0 pt-0">
                                    <div class="card-header-title">
                                        <h4>Monthly Active Users Chart</h4>
                                    </div>

                            
                                </div>

                                <div class="card-body p-0">
                                    <div id="report">
                                        <canvas id="monthlyActiveUsersChart" style="width:100%;max-width:"></canvas>

                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="col-xl-6 col-md-12">
                            <div class="card o-hidden card-hover">
                                <div class="card-header card-header-top card-header--2 px-0 pt-0">
                                    <div class="card-header-title">
                                        <h4>Country  Wise</h4>
                                    </div>

                            
                                </div>

                                <div class="card-body p-0">
                                    <div id="report">
                                        <canvas id="countryWise" style="width:100%;max-width:"></canvas>

                                    </div>
                                </div>
                            </div>
                        </div>
                        <!-- Best Selling Product End -->


                        

                    

                   


                    </div>
                    
                </div>
                <!-- Container-fluid Ends-->

                <!-- footer start-->
                 
                <!-- footer End-->
            </div>
            <!-- index body end -->

            <script>
                console.log({{ country_wise_users_count|safe }});
                console.log({{ category_wise_visited_users_count|safe }});
            
                const lastWeekActiveUsers = JSON.parse('{{ last_week_active_users_list|safe }}');
                const category_wise_visited_users_count = JSON.parse('{{ category_wise_visited_users_count|safe }}');
                const monthly_active_users = JSON.parse('{{ monthly_active_users|safe }}');
                const country_wise_users_count = JSON.parse('{{ country_wise_users_count|safe }}');
            
                // Weekly Active Data
                const weeklyActiveData = {
                    labels: Object.keys(lastWeekActiveUsers), // Get the days (keys) for labels
                    datasets: [{
                        label: 'Active Users',
                        data: Object.values(lastWeekActiveUsers), // Get the user counts (values) for data points
                        backgroundColor: 'rgba(75, 192, 192, 0.6)',
                        borderColor: 'rgba(75, 192, 192, 1)',
                        borderWidth: 1
                    }]
                };
            
                // Monthly Active Data
                const monthlyActiveData = {
                    labels: Object.keys(monthly_active_users), // Directly use the passed list
                    datasets: [{
                        label: 'Active Users',
                        data: Object.values(monthly_active_users), // Directly use the passed list
                        backgroundColor: 'rgba(153, 102, 255, 0.6)',
                        borderColor: 'rgba(153, 102, 255, 1)',
                        borderWidth: 1
                    }]
                };
            
                // Category Visits Data (for horizontal bar chart)
                const categoryVisitsData = {
                    labels: Object.keys(category_wise_visited_users_count),  // Labels on Y-axis
                    datasets: [{
                        label: 'Visits',
                        data: Object.values(category_wise_visited_users_count),  // Data on X-axis
                        backgroundColor: 'rgba(255, 159, 64, 0.6)',
                        borderColor: 'rgba(255, 159, 64, 1)',
                        borderWidth: 1
                    }]
                };
                // Category Visits Data (for horizontal bar chart)
                const catcountryData = {
                    labels: Object.keys(country_wise_users_count),  // Labels on Y-axis
                    datasets: [{
                        label: 'Visits',
                        data: Object.values(country_wise_users_count),  // Data on X-axis
                        backgroundColor: 'rgba(255, 159, 64, 0.6)',
                        borderColor: 'rgba(255, 159, 64, 1)',
                        borderWidth: 1
                    }]
                };
            
                // Function to create charts
                function createChart(ctx, data, title, isHorizontal = false) {
                    new Chart(ctx, {
                        type: 'bar',
                        data: data,
                        options: {
                            indexAxis: isHorizontal ? 'y' : 'x',  // Switch to horizontal if necessary
                            responsive: true,
                            scales: {
                                x: {
                                    beginAtZero: true
                                },
                                y: {
                                    beginAtZero: true,
                                    ticks: {
                                        autoSkip: false  // Ensure all labels are displayed
                                    }
                                }
                            },
                            plugins: {
                                legend: {
                                    position: 'top',
                                },
                                title: {
                                    display: true,
                                    text: title
                                }
                            }
                        }
                    });
                }
            
                // Initialize charts on window load
                window.onload = function() {
                    const weeklyCtx = document.getElementById('weeklyActiveUsersChart').getContext('2d');
                    createChart(weeklyCtx, weeklyActiveData, 'Weekly Active Users');
            
                    const monthlyCtx = document.getElementById('monthlyActiveUsersChart').getContext('2d');
                    createChart(monthlyCtx, monthlyActiveData, 'Monthly Active Users');
            
                    const categoryCtx = document.getElementById('categoryVisitsChart').getContext('2d');
                    createChart(categoryCtx, categoryVisitsData, 'Category Visits', true);  // Pass 'true' to make it horizontal


                    const countryCtx = document.getElementById('countryWise').getContext('2d');
                    createChart(countryCtx, catcountryData, 'Country Wise Users', true);  // Pass 'true' to make it horizontal
                };
            
            </script>
            
                <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

            {% endblock content %}
       